<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barbara's Wellness App</title>
  <style>
    body {
      font-family: 'Space Mono', monospace;
      background-color: #f8f3ee;
      color: #4a3f35;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #d8a48f;
    }
    section {
      margin-bottom: 40px;
    }
    .task-list input[type="checkbox"] {
      margin-right: 10px;
    }
    .journal, .brain-dump {
      background: #fff;
      border: 1px solid #d8a48f;
      padding: 10px;
      font-family: 'Space Mono', monospace;
      white-space: pre-wrap;
      width: 100%;
      height: 100px;
    }
    .emoji-picker {
      font-size: 24px;
      margin: 5px;
      cursor: pointer;
    }
    .emoji-selected {
      font-size: 24px;
      display: inline-block;
      margin-left: 10px;
    }
    #historyList a {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ¿ Barbara's Wellness App</h1>

  <!-- Daily Tasks -->
  <section>
    <h2>ğŸ—“ï¸ To-Do List</h2>
    <ul class="task-list">
      <li><input type="checkbox" onchange="saveState()">Check in with myself</li>
      <li><input type="checkbox" onchange="saveState()">Move my body</li>
      <li><input type="checkbox" onchange="saveState()">Spend 10 mins on a creative project</li>
    </ul>
  </section>

  <!-- Reading Prompt -->
  <section>
    <h2>ğŸ“š Daily Reading</h2>
    <div id="reading-prompt">Loading...</div>
    <button onclick="newReading()">Show Me Another</button>
  </section>

  <!-- Reading History -->
  <section>
    <h2>ğŸ—‚ï¸ Reading History</h2>
    <div id="historyList"></div>
  </section>

  <!-- Mood + Feelings -->
  <section>
    <h2>ğŸ˜Š Mood + Feelings</h2>
    <div id="emojiPicker">
      <span class="emoji-picker" onclick="selectEmoji('ğŸ« ')">ğŸ« </span>
      <span class="emoji-picker" onclick="selectEmoji('ğŸ¥²')">ğŸ¥²</span>
      <span class="emoji-picker" onclick="selectEmoji('ğŸ«¤')">ğŸ«¤</span>
      <span class="emoji-picker" onclick="selectEmoji('ğŸ˜¶â€ğŸŒ«ï¸')">ğŸ˜¶â€ğŸŒ«ï¸</span>
      <span class="emoji-picker" onclick="selectEmoji('ğŸ˜')">ğŸ˜</span>
    </div>
    <div>Selected Mood: <span class="emoji-selected" id="selectedMood"></span></div>
    <input type="text" id="feelingInput" placeholder="Name your feeling (e.g., curious, overwhelmed)" style="width:100%; margin-top:10px;" oninput="saveState()" />
  </section>

  <!-- Brain Dump -->
  <section>
    <h2>ğŸ§  Brain Dump</h2>
    <textarea class="brain-dump" id="brainDump" placeholder="Let it all out in a typewriter-style flow..." oninput="saveState()"></textarea>
  </section>

  <!-- Mini Journal -->
  <section>
    <h2>ğŸ““ Mini Journal</h2>
    <p>Prompt: <span id="journalPrompt">Loading...</span></p>
    <textarea class="journal" id="journalEntry" placeholder="Write freely here..." oninput="saveState()"></textarea>
  </section>

  <script>
    let readings = [];

    function newReading() {
      if (readings.length === 0) return;
      const random = Math.floor(Math.random() * readings.length);
      const selected = readings[random];
      const html = `<a href="${selected.url}" target="_blank">${selected.title}</a>`;
      document.getElementById('reading-prompt').innerHTML = html;
      document.getElementById('journalPrompt').innerText = selected.title;
      addToHistory(selected);
      saveState();
    }

    function addToHistory(reading) {
      let history = JSON.parse(localStorage.getItem('readingHistory') || '[]');
      const exists = history.some(item => item.url === reading.url);
      if (!exists) {
        history.unshift(reading);
        if (history.length > 20) history.pop(); // keep last 20 only
        localStorage.setItem('readingHistory', JSON.stringify(history));
        renderHistory();
      }
    }

    function renderHistory() {
      const container = document.getElementById('historyList');
      container.innerHTML = '';
      const history = JSON.parse(localStorage.getItem('readingHistory') || '[]');
      history.forEach(item => {
        const link = document.createElement('a');
        link.href = item.url;
        link.target = '_blank';
        link.textContent = item.title;
        container.appendChild(link);
      });
    }

    function selectEmoji(emoji) {
      document.getElementById('selectedMood').innerText = emoji;
      localStorage.setItem('selectedMood', emoji);
    }

    function saveState() {
      const checkboxes = document.querySelectorAll('.task-list input[type="checkbox"]');
      const tasks = Array.from(checkboxes).map(cb => cb.checked);
      localStorage.setItem('tasks', JSON.stringify(tasks));

      localStorage.setItem('feelingInput', document.getElementById('feelingInput').value);
      localStorage.setItem('brainDump', document.getElementById('brainDump').value);
      localStorage.setItem('journalEntry', document.getElementById('journalEntry').value);
      localStorage.setItem('readingPrompt', document.getElementById('reading-prompt').innerHTML);
      localStorage.setItem('journalPrompt', document.getElementById('journalPrompt').innerText);
    }

    function loadState() {
      const savedTasks = JSON.parse(localStorage.getItem('tasks') || '[]');
      document.querySelectorAll('.task-list input[type="checkbox"]').forEach((cb, i) => {
        if (savedTasks[i]) cb.checked = true;
      });

      document.getElementById('feelingInput').value = localStorage.getItem('feelingInput') || '';
      document.getElementById('brainDump').value = localStorage.getItem('brainDump') || '';
      document.getElementById('journalEntry').value = localStorage.getItem('journalEntry') || '';

      const savedMood = localStorage.getItem('selectedMood');
      if (savedMood) document.getElementById('selectedMood').innerText = savedMood;

      const savedPrompt = localStorage.getItem('readingPrompt');
      if (savedPrompt) document.getElementById('reading-prompt').innerHTML = savedPrompt;
      const savedJournal = localStorage.getItem('journalPrompt');
      if (savedJournal) document.getElementById('journalPrompt').innerText = savedJournal;
    }

    function fetchReadings() {
      fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTS8Sccsmc95BLpplgS5eNG3KSKHR1wMl4wGulU2VtOLt9-Ao3zpDKGUN0xOjZzK9KOkYO43vK4r1pk/pub?output=csv')
        .then(response => response.text())
        .then(csv => {
          const lines = csv.split('\n').slice(1);
          readings = lines.map(line => {
            const [title, url] = line.split(',');
            return { title: title.trim(), url: url.trim() };
          }).filter(item => item.title && item.url);
          newReading();
        });
    }

    window.onload = function() {
      loadState();
      renderHistory();
      fetchReadings();
    };
  </script>
</body>
</html>
